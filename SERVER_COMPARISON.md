# ESP32 웹서버 vs Node.js 서버 비교

## 📊 핵심 차이점

| 구분 | ESP32 웹서버<br/>(http://172.30.1.63) | Node.js 서버<br/>(localhost:3002) |
|------|--------------------------------------|----------------------------------|
| **위치** | ESP32 보드 내부 | PC (로컬 컴퓨터) |
| **포트** | 80 | 3002 |
| **IP 주소** | 172.30.1.63 (ESP32의 IP) | localhost (127.0.0.1) |
| **실행 환경** | ESP32 하드웨어 | Windows/Linux PC |
| **역할** | **실시간 제어 및 모니터링** | **데이터 로깅 및 관리** |
| **데이터 저장** | ❌ 저장 안함 (메모리만) | ✅ MongoDB에 영구 저장 |
| **접근 범위** | 같은 WiFi 네트워크에서만 | PC에서만 (로컬) |

---

## 🎯 역할별 상세 비교

### ESP32 웹서버 (http://172.30.1.63)

#### 역할: 실시간 제어 및 모니터링

**주요 기능**:
1. ✅ **센서 제어**
   - RGB LED 제어 (빨강/초록/파랑/끄기)
   - 부저 ON/OFF 제어
   - 실시간 하드웨어 제어

2. ✅ **실시간 데이터 표시**
   - 현재 온도/습도 표시 (2초마다 업데이트)
   - 5분 평균 온도/습도 표시
   - 센서에서 직접 읽은 최신 데이터

3. ✅ **제한된 데이터 저장**
   - 최근 5분간 데이터만 메모리에 보관
   - 평균 계산용으로만 사용
   - 재부팅 시 데이터 손실

**특징**:
- ⚡ **빠른 응답**: 하드웨어 직접 제어
- 📱 **모바일 접근 가능**: 같은 WiFi에서 접속 가능
- 💾 **저장 공간 제한**: ESP32 메모리 제약
- 🔄 **임시 데이터**: 재부팅 시 데이터 사라짐

---

### Node.js 서버 (localhost:3002)

#### 역할: 데이터 로깅 및 관리

**주요 기능**:
1. ✅ **데이터 영구 저장**
   - MongoDB에 모든 센서 데이터 저장
   - 재부팅해도 데이터 유지
   - 장기간 데이터 보관

2. ✅ **데이터 조회 및 분석**
   - 과거 데이터 조회 (API)
   - 통계 데이터 계산 (최소/최대/평균)
   - 기간별 데이터 필터링

3. ✅ **MQTT 메시지 수집**
   - `esp32/sensor` 토픽 구독
   - 실시간으로 받은 데이터를 DB에 저장

**특징**:
- 💾 **영구 저장**: MongoDB에 안전하게 저장
- 📊 **데이터 분석**: 통계 및 히스토리 제공
- 🔍 **개발자용**: API를 통한 데이터 접근
- 🖥️ **PC 전용**: localhost에서만 접근 가능

---

## 🔄 데이터 흐름 비교

### ESP32 웹서버 데이터 흐름

```
ESP32 하드웨어
    ↓
센서 읽기 (2초마다)
    ↓
메모리 버퍼 (5분간만 보관)
    ↓
웹서버 API (/sensor)
    ↓
브라우저 (실시간 표시)
```

**특징**: 실시간, 임시 데이터, 제한된 저장

### Node.js 서버 데이터 흐름

```
MQTT Broker
    ↓
esp32/sensor 토픽 메시지
    ↓
Node.js 서버 (MQTT 구독)
    ↓
MongoDB 저장 (영구)
    ↓
HTTP API (/api/sensors/data)
    ↓
개발자/분석 도구 (조회)
```

**특징**: 영구 저장, 히스토리, 분석 가능

---

## 💡 언제 어디서 사용하나?

### ESP32 웹서버 (http://172.30.1.63)

**사용 시나리오**:
- 📱 **모바일에서 센서 제어**: 스마트폰으로 RGB LED 제어
- ⚡ **즉시 반응 필요**: 부저를 바로 켜고 싶을 때
- 📊 **현재 상태 확인**: 지금 온도/습도가 얼마인지 확인
- 🔧 **현장에서 제어**: ESP32 근처에서 직접 제어

**예시**:
```
집에 있을 때:
- 스마트폰으로 http://172.30.1.63 접속
- RGB LED 색상 변경
- 현재 온도/습도 확인
```

### Node.js 서버 (localhost:3002)

**사용 시나리오**:
- 📊 **데이터 분석**: 어제 온도가 얼마였는지 확인
- 📈 **통계 확인**: 지난 주 평균 온도는?
- 💾 **데이터 백업**: 모든 센서 데이터를 안전하게 저장
- 🔬 **개발/디버깅**: API로 데이터 조회 및 분석

**예시**:
```
PC에서 개발할 때:
- 브라우저로 http://localhost:3002/api/sensors/data?limit=100 접속
- 지난 1시간 데이터 확인
- 통계 분석 (최소/최대/평균)
```

---

## 🔗 두 서버의 연관성

### 독립적으로 동작

**ESP32 웹서버**:
- ESP32만 있으면 동작
- Node.js 서버 없어도 센서 제어 가능
- 단독으로 사용 가능

**Node.js 서버**:
- ESP32에서 MQTT 발행만 되면 동작
- ESP32 웹서버와 독립적
- 데이터 저장에 집중

### 함께 사용 시

```
ESP32 웹서버          Node.js 서버
     │                    │
     │                    │
     ▼                    ▼
  MQTT Broker         MQTT Broker
     │                    │
     └────────┬───────────┘
              │
         esp32/sensor 토픽
```

**장점**:
- ESP32 웹서버: 실시간 제어 + 모바일 접근
- Node.js 서버: 데이터 저장 + 분석
- 둘 다 같은 MQTT 메시지를 받음 (독립적)

---

## 📱 접근 방법 비교

### ESP32 웹서버 접근

```
✅ 같은 WiFi 네트워크:
   http://172.30.1.63

✅ 어디서나 접근 가능:
   - 스마트폰 (WiFi 연결 시)
   - 태블릿 (WiFi 연결 시)
   - PC (같은 네트워크)
   - 다른 컴퓨터 (같은 네트워크)
```

**제한사항**:
- ❌ 인터넷 밖에서는 접근 불가 (로컬 네트워크만)
- ❌ ESP32가 꺼지면 접근 불가

### Node.js 서버 접근

```
✅ PC에서만 접근:
   http://localhost:3002
   또는
   http://127.0.0.1:3002

✅ 같은 PC 내에서만:
   - 브라우저 (localhost)
   - API 클라이언트 (localhost)
```

**제한사항**:
- ❌ 다른 기기에서 접근 불가 (로컬 전용)
- ❌ 인터넷 공유 필요 시 설정 추가 필요

---

## 🎯 요약

| 항목 | ESP32 웹서버 | Node.js 서버 |
|------|-------------|-------------|
| **목적** | 실시간 제어 | 데이터 저장 |
| **데이터** | 임시 (5분) | 영구 (MongoDB) |
| **접근** | WiFi 네트워크 내 | PC 로컬만 |
| **사용자** | 일반 사용자 | 개발자/분석가 |
| **기능** | 센서 제어 + 현재 상태 | 데이터 조회 + 통계 |

**비유**:
- **ESP32 웹서버** = 현장 제어판 (버튼과 현재 값 표시)
- **Node.js 서버** = 데이터 센터 (모든 기록 저장 및 분석)

---

## 💻 실제 사용 예시

### 시나리오 1: 집에서 RGB LED 제어
```
1. 스마트폰으로 http://172.30.1.63 접속
2. RGB LED 빨강 버튼 클릭
3. 즉시 LED 색상 변경 ✅
```
→ **ESP32 웹서버 사용**

### 시나리오 2: 지난 주 온도 데이터 분석
```
1. PC에서 http://localhost:3002/api/sensors/statistics?days=7 접속
2. 지난 7일간 통계 확인
3. 최소/최대/평균 온도 확인 ✅
```
→ **Node.js 서버 사용**

### 시나리오 3: 현재 온도 확인
```
1. 스마트폰으로 http://172.30.1.63 접속
2. 실시간 온도/습도 표시 확인 ✅
```
→ **ESP32 웹서버 사용** (더 빠르고 간단)

### 시나리오 4: 모든 센서 데이터 내보내기
```
1. PC에서 http://localhost:3002/api/sensors/data?limit=1000 접속
2. 최근 1000개 데이터 다운로드
3. Excel로 분석 ✅
```
→ **Node.js 서버 사용** (데이터 저장 필요)

